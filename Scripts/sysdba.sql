ALTER SESSION SET "_ORACLE_SCRIPT" = TRUE;

DROP USER QLKS CASCADE;
CREATE USER QLKS IDENTIFIED BY QLKS1234;

GRANT ALL PRIVILEGES TO QLKS;
GRANT CREATE SESSION TO QLKS;

CREATE TABLE QLKS.NHANVIEN (
    MANV NVARCHAR2(10),
    TENNV NVARCHAR2(35),
    DIACHI NVARCHAR2(100),
    SDT VARCHAR(11),
    CHUCVU NVARCHAR2(20),
    PRIMARY KEY (MANV)
);

CREATE TABLE QLKS.KHACHHANG (
    MAKH NVARCHAR2(10),
    TENKH NVARCHAR2(35),
    SDT VARCHAR(11),
    DIACHI NVARCHAR2(100),
    EMAIL VARCHAR(50),
    SOFAX VARCHAR(11),
    TENDOAN NVARCHAR2(35),
    SOLUONGNGUOI INT,
    PRIMARY KEY (MAKH)
);

CREATE TABLE QLKS.LOAIPHONG (
    TENLOAIPHONG NVARCHAR2(50),
    SOLUONG INT,
    SOPHONGTRONG INT,
    GIA INT,
    MOTA NVARCHAR2(200),
    PRIMARY KEY (TENLOAIPHONG)
);

CREATE TABLE QLKS.PHONG (
    MAPHONG NVARCHAR2(10),
    TENLOAIPHONG NVARCHAR2(50),
    TINHTRANG NUMBER(1,0),
    TTDONDEP NVARCHAR2(20),
    PRIMARY KEY (MAPHONG)
);

CREATE TABLE QLKS.DATPHONG (
    MADATPHG NVARCHAR2(10),
    MAKH NVARCHAR2(10),
    TENLOAIPHONG NVARCHAR2(50),
    NGAYDEN DATE,
    SODEMLUUTRU INT,
    PRIMARY KEY (MADATPHG)
);

CREATE TABLE QLKS.CHITIETPHONGDAT (
    MADATPHG NVARCHAR2(10),
    MAPHG NVARCHAR2(10),
    PRIMARY KEY (MADATPHG,MAPHG)
);

CREATE TABLE QLKS.DICHVU (
    MADV NVARCHAR2(10),
    TENDV NVARCHAR2(100),
    GIA INT,
    PRIMARY KEY (MADV)
);

CREATE TABLE QLKS.CHITIETDATDV (
    MAPHONG NVARCHAR2(10),
    MADV NVARCHAR2(10),
    SOLUONG INT,
    PRIMARY KEY (MAPHONG, MADV)
);

CREATE TABLE QLKS.HOADON (
    MAHD NVARCHAR2(10),
    MANV NVARCHAR2(10),
    MADATPHG NVARCHAR2(10),
    NGAYLAP DATE,
    TONGTIEN INT,
    PRIMARY KEY (MAHD)
);

CREATE TABLE QLKS.TOURDULICH (
    MATOUR NVARCHAR2(10),
    TENTOUR NVARCHAR2(100),
    DIADIEM NVARCHAR2(200),
    GIA INT,
    THOIGIAN DATE,
    PRIMARY KEY (MATOUR)
);

CREATE TABLE QLKS.DKTOUR (
    MADKTOUR NVARCHAR2(10),
    MATOUR NVARCHAR2(10),
    TENKH NVARCHAR2(50),
    SDT VARCHAR(11),
    SONGUOITG INT,
    HINHTHUCDICHUYEN NVARCHAR2(20),
    THOIGIANXUATPHAT DATE,
    NHUCAUDACBIET NVARCHAR2(100),
    PRIMARY KEY (MADKTOUR)
);

CREATE TABLE QLKS.DOITAC (
    MADT NVARCHAR2(10),
    TENDT NVARCHAR2(20),
    MATOUR NVARCHAR2(10),
    DIACHI NVARCHAR2(200),
    SDT VARCHAR(11),
    EMAIL VARCHAR(50),
    PRIMARY KEY (MADT)
);

CREATE TABLE QLKS.QUYDINH (
    MAQD NVARCHAR2(10),
    NOIDUNG NVARCHAR2(200),
    PRIMARY KEY (MAQD)
);

CREATE TABLE QLKS.YEUCAUDP (
    MAYC NVARCHAR2(10),
    SDT NVARCHAR2(11),
    TENLOAIPHONG NVARCHAR2(50),
    SOLUONG NUMBER CONSTRAINT ck_SOLUONG CHECK (SOLUONG >= 1),
    NGAYYEUCAU DATE DEFAULT SYSDATE
);

CREATE SEQUENCE QLKS.nhanvien_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE QLKS.khachhang_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE QLKS.phong_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE QLKS.datphong_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE QLKS.dichvu_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE QLKS.hoadon_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE QLKS.tour_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE QLKS.dktour_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE QLKS.doitac_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE QLKS.quydinh_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE QLKS.ycdatphong_seq START WITH 1 INCREMENT BY 1;

CREATE OR REPLACE TRIGGER trg_generate_id_ycdatphong
BEFORE INSERT ON QLKS.YEUCAUDP
FOR EACH ROW
BEGIN
    SELECT 'YC' || LPAD(QLKS.ycdatphong_seq.NEXTVAL, 3, '0') INTO :NEW.MAYC FROM dual;
END;
/

CREATE OR REPLACE TRIGGER trg_generate_id_quydinh
BEFORE INSERT ON QLKS.QUYDINH
FOR EACH ROW
BEGIN
    SELECT 'QD' || LPAD(QLKS.quydinh_seq.NEXTVAL, 3, '0') INTO :NEW.MAQD FROM dual;
END;
/

CREATE OR REPLACE TRIGGER trg_generate_id_doitac
BEFORE INSERT ON QLKS.DOITAC
FOR EACH ROW
BEGIN
    SELECT 'DT' || LPAD(QLKS.doitac_seq.NEXTVAL, 3, '0') INTO :NEW.MADT FROM dual;
END;
/

CREATE OR REPLACE TRIGGER trg_generate_id_dktour
BEFORE INSERT ON QLKS.DKTOUR
FOR EACH ROW
BEGIN
    SELECT 'DK' || LPAD(QLKS.dktour_seq.NEXTVAL, 3, '0') INTO :NEW.MADKTOUR FROM dual;
END;
/

CREATE OR REPLACE TRIGGER trg_generate_id_tour
BEFORE INSERT ON QLKS.TOURDULICH
FOR EACH ROW
BEGIN
    SELECT 'T' || LPAD(QLKS.tour_seq.NEXTVAL, 3, '0') INTO :NEW.MATOUR FROM dual;
END;
/

CREATE OR REPLACE TRIGGER trg_generate_id_hoadon
BEFORE INSERT ON QLKS.HOADON
FOR EACH ROW
BEGIN
    SELECT 'HD' || LPAD(QLKS.hoadon_seq.NEXTVAL, 3, '0') INTO :NEW.MAHD FROM dual;
END;
/

CREATE OR REPLACE TRIGGER trg_generate_id_dichvu
BEFORE INSERT ON QLKS.DICHVU
FOR EACH ROW
BEGIN
    SELECT 'DV' || LPAD(QLKS.dichvu_seq.NEXTVAL, 3, '0') INTO :NEW.MADV FROM dual;
END;
/

CREATE OR REPLACE TRIGGER trg_generate_id_datphong
BEFORE INSERT ON QLKS.DATPHONG
FOR EACH ROW
BEGIN
    SELECT 'DP' || LPAD(QLKS.datphong_seq.NEXTVAL, 3, '0') INTO :NEW.MADATPHG FROM dual;
END;
/

CREATE OR REPLACE TRIGGER trg_generate_id_phong
BEFORE INSERT ON QLKS.PHONG
FOR EACH ROW
BEGIN
    SELECT 'P' || LPAD(QLKS.phong_seq.NEXTVAL, 3, '0') INTO :NEW.MAPHONG FROM dual;
END;
/

CREATE OR REPLACE TRIGGER trg_generate_id_khachhang
BEFORE INSERT ON QLKS.KHACHHANG
FOR EACH ROW
BEGIN
    SELECT 'KH' || LPAD(QLKS.khachhang_seq.NEXTVAL, 3, '0') INTO :NEW.MAKH FROM dual;
END;
/

CREATE OR REPLACE TRIGGER trg_generate_id_nhanvien
BEFORE INSERT ON QLKS.NHANVIEN
FOR EACH ROW
BEGIN
    SELECT 'NV' || LPAD(QLKS.nhanvien_seq.NEXTVAL, 3, '0') INTO :NEW.MANV FROM dual;
END;
/
 
INSERT INTO QLKS.HOADON VALUES('', 'NV001', 'DP001', TO_DATE('2022-07-10', 'YYYY-MM-DD'), 2350000);
INSERT INTO QLKS.HOADON VALUES('', 'NV001', 'DP002', TO_DATE('2022-07-13', 'YYYY-MM-DD'), 2500000);
INSERT INTO QLKS.HOADON VALUES('', 'NV001', 'DP003', TO_DATE('2022-07-15', 'YYYY-MM-DD'), 2500000);
INSERT INTO QLKS.HOADON VALUES('', 'NV001', 'DP004', TO_DATE('2022-07-16', 'YYYY-MM-DD'), 2005000);
INSERT INTO QLKS.HOADON VALUES('', 'NV001', 'DP005', TO_DATE('2022-07-18', 'YYYY-MM-DD'), 2280000);
select * from QLKS.HOADON;
INSERT INTO QLKS.TOURDULICH(TENTOUR,DIADIEM,GIA, THOIGIAN) VALUES ('Du lich Nha Trang','Nha Trang',2000000,TO_DATE('2023-07-11','YYYY-MM-DD'));
INSERT INTO QLKS.TOURDULICH(TENTOUR,DIADIEM,GIA, THOIGIAN) VALUES ('Tour dao Phu Quy','Binh Thuan', 1500000,TO_DATE('2023-07-14','YYYY-MM-DD'));
INSERT INTO QLKS.TOURDULICH(TENTOUR,DIADIEM,GIA, THOIGIAN) VALUES ('Du lich Da Lat','Da Lat',1000000, TO_DATE('2023-08-15','YYYY-MM-DD'));
INSERT INTO QLKS.TOURDULICH(TENTOUR,DIADIEM,GIA, THOIGIAN) VALUES ('Kham pha pho co Hoi An','Quang Nam', 5000000, TO_DATE('2023-08-23','YYYY-MM-DD'));
INSERT INTO QLKS.TOURDULICH(TENTOUR,DIADIEM,GIA, THOIGIAN) VALUES ('Du lich Maldives','An Do',40000000, TO_DATE('2023-11-01','YYYY-MM-DD'));

INSERT INTO QLKS.DKTOUR VALUES ('','T001','Tran Ngoc Nguyen','0924563643',3, 'Tu tuc di chuyen',TO_DATE('2023-06-30','YYYY-MM-DD'),NULL);
INSERT INTO QLKS.DKTOUR VALUES ('','T005','Nguyen Van Quan', '0264850126', 2,'Tu tuc di chuyen',TO_DATE('2023-06-30','YYYY-MM-DD'),NULL);
INSERT INTO QLKS.DKTOUR VALUES ('','T002','Nguyen Dinh Viet', '0836625519',1,'Tu tuc di chuyen',TO_DATE('2023-06-26','YYYY-MM-DD'),'An chay');
INSERT INTO QLKS.DKTOUR VALUES ('','T003','Pham Ngoc Huyen', '0222573275',7, 'Dua don',TO_DATE('2023-06-30','YYYY-MM-DD'),NULL);
INSERT INTO QLKS.DKTOUR VALUES ('','T004','Huynh Anh Tuan', '0173385742',4,'Dua don',TO_DATE('2023-07-30','YYYY-MM-DD'),NULL);

INSERT INTO QLKS.DOITAC VALUES('',N'SaiGonTourist', N'T003', N'Le Loi, Q1','0938225877',N'info@saigontourist.com.vn');
INSERT INTO QLKS.DOITAC VALUES('',N'VietTravel', N'T005', N'Pasteur, Q3','0938228898',N'info@vietravel.com.vn');
INSERT INTO QLKS.DOITAC VALUES('',N'Thien Anh Travel', N'T001', N'Duong so 5, Go Vap','02866805803',N'dulichthienanh.vn@gmail.com');
INSERT INTO QLKS.DOITAC VALUES('',N'Tugo', N'T002', N'Ly Tu Trong, Q1','02873065543',N'support@tugo.com.vn');
INSERT INTO QLKS.DOITAC VALUES('',N'Du Lich Viet', N'T004', N'Hoang Van Thu, Phu Nhuan','02873056789',N'info@dulichviet.com');

INSERT INTO QLKS.QUYDINH VALUES('', N'Vui long xuat trinh ho chieu hoac CCCD de lam thu tuc nhan phong');
INSERT INTO QLKS.QUYDINH VALUES('', N'Khong mang chat gay no, chat doc hai, vat nuoi hoac thuc pham co mui tanh, hoi vao khach san');
INSERT INTO QLKS.QUYDINH VALUES('', N'Khong dua them nguoi la vao phong khi chua dang ki voi Le tan');
INSERT INTO QLKS.QUYDINH VALUES('', N'Khong lam hu hong tai san trong phong khach san, neu lam hu Quy khach se phai boi thuong');
INSERT INTO QLKS.QUYDINH VALUES('', N'Thoi gian tra phong la 12h30, neu muon phai thanh toan phi tuong ung. Trong truong hop can thiet, vui long lien he Le tan');

INSERT INTO QLKS.DICHVU VALUES('',N'Giat ui','200000');
INSERT INTO QLKS.DICHVU VALUES('',N'Cho thue xe may','500000');
INSERT INTO QLKS.DICHVU VALUES('',N'Spa','1000000');
INSERT INTO QLKS.DICHVU VALUES('',N'Dua ruoc san bay','500000');
INSERT INTO QLKS.DICHVU VALUES('',N'Cho thue phong hop','2000000');

INSERT INTO QLKS.NHANVIEN VALUES('', 'Nguyen Thi Dung', 'Hung Vuong, Q1', '0788123000', 'Le tan');
INSERT INTO QLKS.NHANVIEN VALUES('', 'Tran Bao Ngoc', 'Nguyen Thi Minh Khai, Q3', '0173305925', 'Le tan');
INSERT INTO QLKS.NHANVIEN VALUES('', 'Huynh Van Chien', 'Ngo Quyen, Q10', '09853855551', 'Le tan');
INSERT INTO QLKS.NHANVIEN VALUES('', 'Nguyen Cuc Phuong', 'Pham Ngoc Thach, Q1', '0539682201', 'Le tan');
INSERT INTO QLKS.NHANVIEN VALUES('', 'Pham Hong Hanh', 'Vo Van Tan, Q3', '0582295576', 'Le tan');

INSERT INTO QLKS.KHACHHANG VALUES('', 'Tran Ngoc Nguyen', '0924563643', 'Nguyen Trai, Go Vap', 'tnn@gmail.com', '123', null, null);
INSERT INTO QLKS.KHACHHANG VALUES('', 'Nguyen Van Quan', '0264850126', 'Vo Van Ngan, Thu Duc', 'nvq@gmail.com', '145', null, null);
INSERT INTO QLKS.KHACHHANG VALUES('', 'Nguyen Dinh Viet', '0836625519', 'Le Van Viet, Q9', 'ndv@gmail.com', '297', null, null);
INSERT INTO QLKS.KHACHHANG VALUES('', 'Pham Ngoc Huyen', '0222573275', 'Hai Ba Trung, Q1', 'pnh@gmail.com', '682', 'Doan 123', 10);
INSERT INTO QLKS.KHACHHANG VALUES('', 'Huynh Anh Tuan', '0173385742', 'Vo Thi Sau, Q8', 'hat@gmail.com', '917', 'Doan abc', 6);

INSERT INTO QLKS.LOAIPHONG VALUES('Phong don', 20, 14, 500000, null);
INSERT INTO QLKS.LOAIPHONG VALUES('Phong doi', 10, 8, 1000000, null);
INSERT INTO QLKS.LOAIPHONG VALUES('Phong 4 nguoi', 8, 5, 1800000, null);
INSERT INTO QLKS.LOAIPHONG VALUES('Phong 6 nguoi', 8, 6, 2500000, null);
INSERT INTO QLKS.LOAIPHONG VALUES('Phong VIP', 5, 2, 3000000, null);

INSERT INTO QLKS.PHONG VALUES('','Phong don',0,'Da don');
INSERT INTO QLKS.PHONG VALUES('','Phong 4 nguoi',0,'Da don');
INSERT INTO QLKS.PHONG VALUES('','Phong doi',0,'Da don');
INSERT INTO QLKS.PHONG VALUES('','Phong don',0,'Dang don');
INSERT INTO QLKS.PHONG VALUES('','Phong VIP',1,'Da don');
INSERT INTO QLKS.PHONG VALUES('','Phong 4 nguoi',0,'Dang don');

INSERT INTO QLKS.DATPHONG VALUES ('','KH001','Phong doi',TO_DATE('2023-06-28','YYYY-MM-DD'),2);
INSERT INTO QLKS.DATPHONG VALUES ('','KH002','Phong doi',TO_DATE('2023-06-26','YYYY-MM-DD'),2);
INSERT INTO QLKS.DATPHONG VALUES ('','KH003','Phong VIP',TO_DATE('2023-06-20','YYYY-MM-DD'),1);
INSERT INTO QLKS.DATPHONG VALUES ('','KH004','Phong 4 nguoi',TO_DATE('2023-06-28','YYYY-MM-DD'),2);
INSERT INTO QLKS.DATPHONG VALUES ('','KH005','Phong don',TO_DATE('2023-06-22','YYYY-MM-DD'),1);

INSERT INTO QLKS.YEUCAUDP(SDT, TENLOAIPHONG, SOLUONG) VALUES ('076889754', 'Phong doi', 1); 

INSERT INTO QLKS.CHITIETPHONGDAT VALUES ('DP001', 'P001');
INSERT INTO QLKS.CHITIETPHONGDAT VALUES ('DP002', 'P002');
INSERT INTO QLKS.CHITIETPHONGDAT VALUES ('DP003', 'P003');
INSERT INTO QLKS.CHITIETPHONGDAT VALUES ('DP004', 'P004');
INSERT INTO QLKS.CHITIETPHONGDAT VALUES ('DP005', 'P005');
 
INSERT INTO QLKS.CHITIETDATDV VALUES('P001', 'DV001', 1);
INSERT INTO QLKS.CHITIETDATDV VALUES('P001', 'DV002', 1);
INSERT INTO QLKS.CHITIETDATDV VALUES('P004', 'DV001', 1);
INSERT INTO QLKS.CHITIETDATDV VALUES('P003', 'DV004', 1);
INSERT INTO QLKS.CHITIETDATDV VALUES('P005', 'DV004', 1);

--TABLE NHANVIEN
ALTER TABLE QLKS.HOADON ADD CONSTRAINT FK_HD_NV FOREIGN KEY (MANV) REFERENCES QLKS.NHANVIEN (MANV); 
--TABLE KHACHHANG
ALTER TABLE QLKS.DATPHONG ADD CONSTRAINT FK_DP_KH FOREIGN KEY (MAKH) REFERENCES QLKS.KHACHHANG (MAKH); 
--TABLE LOAIPHONG
ALTER TABLE QLKS.PHONG ADD CONSTRAINT FK_PHG_LOAIPHG FOREIGN KEY (TENLOAIPHONG) REFERENCES QLKS.LOAIPHONG (TENLOAIPHONG);
ALTER TABLE QLKS.DATPHONG ADD CONSTRAINT FK_DP_LP FOREIGN KEY (TENLOAIPHONG) REFERENCES QLKS.LOAIPHONG (TENLOAIPHONG);
--TABLE PHONG
ALTER TABLE QLKS.CHITIETPHONGDAT ADD CONSTRAINT FK_CTPD_PHG FOREIGN KEY (MAPHG) REFERENCES QLKS.PHONG (MAPHONG);
ALTER TABLE QLKS.CHITIETDATDV ADD CONSTRAINT FK_CTDV_PHG FOREIGN KEY (MAPHONG) REFERENCES QLKS.PHONG (MAPHONG); 
--TABLE DATPHONG
ALTER TABLE QLKS.CHITIETPHONGDAT ADD CONSTRAINT FK_CTPD_DP FOREIGN KEY (MADATPHG) REFERENCES QLKS.DATPHONG (MADATPHG);
ALTER TABLE QLKS.HOADON ADD CONSTRAINT FK_HD_DP FOREIGN KEY (MADATPHG) REFERENCES QLKS.DATPHONG (MADATPHG); 
--TABLE DICHVU
ALTER TABLE QLKS.CHITIETDATDV ADD CONSTRAINT FK_CTDV_DV FOREIGN KEY (MADV) REFERENCES QLKS.DICHVU (MADV); 
--TABLE TOURDULICH
ALTER TABLE QLKS.DKTOUR ADD CONSTRAINT FK_DKT_TOUR FOREIGN KEY (MATOUR) REFERENCES QLKS.TOURDULICH (MATOUR); 
ALTER TABLE QLKS.DOITAC ADD CONSTRAINT FK_DT_MTR FOREIGN KEY (MATOUR) REFERENCES QLKS.TOURDULICH (MATOUR); 
--TABLE YEUCAUDP
ALTER TABLE QLKS.YEUCAUDP ADD CONSTRAINT FK_YC_LP FOREIGN KEY (TENLOAIPHONG) REFERENCES QLKS.LOAIPHONG (TENLOAIPHONG);

SELECT * FROM QLKS.PHONG;
select*from QLKS.CHITIETDATDV ;